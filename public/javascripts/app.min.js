(function(){var e;e=angular.module("openStackBackupManager",["ngAnimate","ngRoute","mgcrea.ngStrap","angularMoment","ngResource"]).config(["$locationProvider","$routeProvider",function(e,n){e.html5Mode(!0),n.when("/clients",{templateUrl:"/static/partials/list.tpl.html",controller:"ClientCtrl"}).when("/clients/new",{templateUrl:"/static/partials/new.tpl.html",controller:"ClientAddCtrl"}).when("/jobs",{templateUrl:"/static/partials/jobs.tpl.html",controller:"JobsCtrl"}).otherwise({redirectTo:"/clients"})}]),e.factory("Client",["$resource",function(e){return e("/api/clients/:clientId",{clientId:"@_id"},{query:{method:"GET",isArray:!0},save:{method:"POST"}})}]),e.factory("Server",["$resource",function(e){return e("/api/servers",{},{query:{method:"POST",isArray:!0}})}]),e.factory("Job",["$resource",function(e){return e("/api/jobs/:jobid",{jobid:"@_id"},{query:{method:"GET",isArray:!0},save:{method:"POST"},"delete":{method:"DELETE"}})}]),e.controller("JobsCtrl",["Job","$scope",function(e,n){n.loading=!0,n.jobs=[],n.detailedJob=null,n.jobPredicate="-created",n.jobPredicateReverse=!1,n.jobLimit=10,n.viewDetailJob=function(e){n.detailedJob=e},n.refreshJobs=function(){return n.loading=!0,n.jobs=e.query(function(){n.loading=!1})},n.getStatusClass=function(e){return e.deleting?"glyphicon glyphicon-trash":"completed"===e.status?"glyphicon glyphicon-ok":"queued"===e.status?"glyphicon glyphicon-time":void 0},n.getDateInformation=function(e){return"completed"===e.status?"Completed "+moment(e.finished).format("MMM d @ h:mma"):"queued"===e.status?"Queued for "+moment(e.queued_for).format("MMM d @ h:mma"):void 0},n.removeJob=function(e){e.deleting=!0,e.$delete(function(){n.jobs.splice(n.jobs.indexOf(e),1)})},n.refreshJobs()}]),e.controller("ServerCtrl",["Job","$scope","$location","$alert",function(e,n,t,o){return n.current_job={},n.button_confirm_text="",n.confirm_dialog={},n.queueJob=function(i){var r;n.confirm_dialog.loading=!0,r=new e(n.current_job),r.$save(function(){i(),n.confirm_dialog.loading=!1,n.current_job={},t.path("/jobs"),o({title:"Job Created",content:"The job has been posted",placement:"top-right",show:!0,type:"success",duration:8})})},n.cancelJob=function(){n.current_job={}},n.prepareRestoreImage=function(e,t){n.current_job={type:"restore_server",client:n.selected_client._id,server:e.id,image:t.id},n.confirm_dialog.confirm_text="Restore from Backup",n.confirm_dialog.confirm=n.queueJob,n.confirm_dialog.cancel=n.cancelJob,n.confirm_dialog.loading=!1},n.prepareDestroyJob=function(e){n.confirm_dialog.confirm_text="Destroy Server",n.current_job={type:"delete_server",client:n.selected_client._id,server:e.id},n.confirm_dialog.confirm=n.queueJob,n.confirm_dialog.cancel=n.cancelJob,n.confirm_dialog.loading=!1},n.prepareDeleteImageJob=function(e,t){n.current_job={type:"delete_image",client:n.selected_client._id,server:e.id,image:t.id},n.confirm_dialog.confirm_text="Delete Backup",n.confirm_dialog.confirm=n.queueJob,n.confirm_dialog.cancel=n.cancelJob,n.confirm_dialog.loading=!1},n.prepareBackupJob=function(e){n.current_job={type:"create_image",client:n.selected_client._id,server:e.id,name:""+e.name+" - Backup "+moment().format("MMMM, D YYYY")},n.confirm_dialog.confirm_text="Queue Backup",n.confirm_dialog.confirm=n.queueJob,n.confirm_dialog.cancel=n.cancelJob,n.confirm_dialog.loading=!1},n.prepareToggleBackups=function(e){return n.confirm_dialog.confirm_text="Confirm",n.confirm_dialog.confirm=function(t){n.confirm_dialog.loading=!0,e.backups_enabled=null!=e.backups_enabled?!e.backups_enabled:!0,n.selected_client.$save(function(){t(),n.confirm_dialog.loading=!1,o({title:"Change finished!",content:""+e.name+" now has backups "+(e.backups_enabled?"enabled":"disabled")+".",placement:"top-right",show:!0,type:"success",duration:8})})},n.confirm_dialog.cancel=function(){}},n.toggleBackupsButtonText=function(e){return null!=e.backups_enabled&&e.backups_enabled?"Disable Automated Backups":"Enable Automated Backups"}}]),e.controller("ClientCtrl",["Client","$scope","$location",function(e,n){n.clients=[],n.selected_client=null,n.loading=!0,n.newClient={},n.selectClient=function(e){n.selected_client=e},n.loadClients=function(){n.loading=!0,n.selected_client=null,n.clients=e.query(function(){n.loading=!1})},n.loadClients()}]),e.controller("ClientAddCtrl",["Client","Server","$http","$scope","$location",function(e,n,t,o,i){var r;return o.step=1,o.loading=!1,o.loading_text="",o.client={servers:[],account:{password:"",name:"",userName:""}},o.current_step=1,o.providers=[{name:"CloudA",authUrl:"http://api.cell01.clouda.ca:5000",region:"regionOne"}],o.selectedProvider=o.providers[0],o.listServers=function(){o.loading=!0,o.client.account.authUrl=o.selectedProvider.authUrl,o.client.account.region=o.selectedProvider.region,o.client.servers=n.query(o.client,function(){o.loading=!1})},o.toggleServer=function(e){e.backups_enabled=e.backups_enabled?!1:!0},r=function(){var n;return delete o.client.server_list,o.loading=!0,n=new e(o.client),n.$save(function(){return o.loading=!1,i.path("/")})},o.nextStep=function(){return o.current_step++,2===o.current_step?o.listServers():4===o.current_step?r():void 0}}])}).call(this);